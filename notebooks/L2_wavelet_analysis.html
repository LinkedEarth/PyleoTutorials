
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Wavelet Analysis with Pyleoclim &#8212; Pyleoclim Tutorials</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/sphinx-book-theme.css?v=eba8b062" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js?v=36754332"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'notebooks/L2_wavelet_analysis';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="prev" title="Tracing Transformations" href="L2_tracing_transformations.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/pyleoclim_insigna_full_white.png" class="logo__image only-light" alt="Pyleoclim Tutorials - Home"/>
    <script>document.write(`<img src="../_static/pyleoclim_insigna_full_white.png" class="logo__image only-dark" alt="Pyleoclim Tutorials - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../intro.html">
                    PyleoTutorials: A Gentle Introduction to the Pyleoclim Package.
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Getting Started</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="L0_a_quickstart.html">Overview of Pyleoclim: Efficient &amp; Flexible Timeseries Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="L0_basic_MSES_manipulation.html">Working with multiple records: <code class="docutils literal notranslate"><span class="pre">MultipleSeries</span></code> and <code class="docutils literal notranslate"><span class="pre">EnsembleSeries</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="L0_basic_ts_manipulation.html">Basic timeseries manipulation</a></li>
<li class="toctree-l1"><a class="reference internal" href="L0_loading_to_series.html">Loading data into Pyleoclim</a></li>
<li class="toctree-l1"><a class="reference internal" href="L0_paleopandas.html">Working with <code class="docutils literal notranslate"><span class="pre">Pandas</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="L0_working_with_geoseries.html">Working with GeoSeries</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Manipulating Data and Graphics</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="L1_figures_with_multiple_panels.html">Pyleoclim figures with multiple panels</a></li>
<li class="toctree-l1"><a class="reference internal" href="L1_filtering_and_detrending.html">Filtering and Detrending with Pyleoclim</a></li>
<li class="toctree-l1"><a class="reference internal" href="L1_surrogates.html">Using Surrogate Series with Pyleoclim</a></li>
<li class="toctree-l1"><a class="reference internal" href="L1_time_semanics.html">Time Semantics</a></li>
<li class="toctree-l1"><a class="reference internal" href="L1_uniform_time_sampling.html">Uniform time sampling with Pyleoclim</a></li>
<li class="toctree-l1"><a class="reference internal" href="L1_working_with_age_ensembles.html">Working with Age Ensembles</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Data Analysis with Pyleoclim</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="L2_correlations.html">Correlation Analysis in Pyleoclim</a></li>
<li class="toctree-l1"><a class="reference internal" href="L2_outlier_detection.html">Outlier Detection with Pyleoclim</a></li>
<li class="toctree-l1"><a class="reference internal" href="L2_principal_component_analysis.html">Principal Component Analysis with Pyleoclim</a></li>
<li class="toctree-l1"><a class="reference internal" href="L2_singular_spectrum_analysis.html">Singular Spectrum Analysis with Pyleoclim</a></li>
<li class="toctree-l1"><a class="reference internal" href="L2_spectral_analysis.html">Spectral Analysis with Pyleoclim</a></li>
<li class="toctree-l1"><a class="reference internal" href="L2_tracing_transformations.html">Tracing Transformations</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Wavelet Analysis with Pyleoclim</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://mybinder.org/v2/gh/LinkedEarth/PyleoTutorials/jupyterbook?urlpath=tree/docs/notebooks/L2_wavelet_analysis.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch on Binder"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img alt="Binder logo" src="../_static/images/logo_binder.svg">
  </span>
<span class="btn__text-container">Binder</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/LinkedEarth/PyleoTutorials" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/LinkedEarth/PyleoTutorials/issues/new?title=Issue%20on%20page%20%2Fnotebooks/L2_wavelet_analysis.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/notebooks/L2_wavelet_analysis.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Wavelet Analysis with Pyleoclim</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#preamble">Preamble</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#goals">Goals</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#keywords">Keywords</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#pre-requisites">Pre-requisites</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#relevant-packages">Relevant Packages</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#data-description">Data description</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#demonstration">Demonstration</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#loading-and-visualizing-delta-d-series">Loading and visualizing <span class="math notranslate nohighlight">\(\delta D\)</span> series</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#wavelet-analysis">Wavelet Analysis</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#customizing-the-frequency-range">Customizing the frequency range</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#significance-testing">Significance Testing</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#temperature-vs-co-2">Temperature vs <span class="math notranslate nohighlight">\(CO_2\)</span></a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#data-wrangling">Data Wrangling</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#wavelet-coherence">Wavelet Coherence</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#takeways">Takeways</a></li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <img src='https://github.com/LinkedEarth/Logos/blob/master/Pyleoclim/PYLEOCLIM_logo_HORZ-01.png?raw=true' width="800">
<section class="tex2jax_ignore mathjax_ignore" id="wavelet-analysis-with-pyleoclim">
<h1>Wavelet Analysis with Pyleoclim<a class="headerlink" href="#wavelet-analysis-with-pyleoclim" title="Link to this heading">#</a></h1>
<p>by <a class="reference external" href="https://orcid.org/0000-0001-5920-4751">Julien Emile-Geay</a></p>
<section id="preamble">
<h2>Preamble<a class="headerlink" href="#preamble" title="Link to this heading">#</a></h2>
<p>Wavelet analysis is one of the most misused tools in climate timeseries analysis, partially due to the popularity of <a class="reference external" href="https://atoc.colorado.edu/research/wavelets/">this webpage</a>, which used to feature an interactive  plotter. Wavelets are a very broad topic in applied mathematics, which we won’t attempt to summarize here. In the paleoclimate context, the term nearly always refers to the Continuous Wavelet Transform, and 99% of the time this uses the Morlet wavelet, which is a generalization of Fourier bases to endow them with localization in time and scale. Accordingly, this demo focuses on how to obtain wavelet spectra from the iconic EPICA Dome C record by <a class="reference external" href="https://doi.org/10.1126/science.1141038">Jouzel et al. (2007)</a>, and how to establish its coherency with a record of atmospheric <span class="math notranslate nohighlight">\(CO_2\)</span>.</p>
<section id="goals">
<h3>Goals<a class="headerlink" href="#goals" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p>How to perform wavelet analysis and wavelet coherence in <code class="docutils literal notranslate"><span class="pre">Pyleoclim</span></code></p></li>
<li><p>Wavelet and coherence analysis for evenly- vs unevenly-spaced data</p></li>
<li><p>Learning about the <a class="reference external" href="https://pyleoclim-util.readthedocs.io/en/master/core/api.html#scalogram-pyleoclim-scalogram">Scalogram</a> and <a class="reference external" href="https://pyleoclim-util.readthedocs.io/en/master/core/api.html#coherence-pyleoclim-coherence">Coherence</a> classes</p></li>
<li><p>How to establish the significance of scalogram or coherence</p></li>
<li><p>How to interpret the results of wavelet and wavelet coherence analyses</p></li>
</ul>
<p><strong>Reading Time: 20 min</strong></p>
</section>
<section id="keywords">
<h3>Keywords<a class="headerlink" href="#keywords" title="Link to this heading">#</a></h3>
<p>Wavelet Analysis, Wavelet Transform Coherency, Visualization</p>
</section>
<section id="pre-requisites">
<h3>Pre-requisites<a class="headerlink" href="#pre-requisites" title="Link to this heading">#</a></h3>
<p>Some timeseries analysis, ideally</p>
</section>
<section id="relevant-packages">
<h3>Relevant Packages<a class="headerlink" href="#relevant-packages" title="Link to this heading">#</a></h3>
<p>pyleoclim, pandas, matplotlib, numpy</p>
</section>
</section>
<section id="data-description">
<h2>Data description<a class="headerlink" href="#data-description" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p>ice phase deuterium data (<span class="math notranslate nohighlight">\(\delta D\)</span>) from <a class="reference external" href="https://doi.org/10.1126/science.1141038">Jouzel et al. (2007)</a>. <span class="math notranslate nohighlight">\(\delta D\)</span>  is a proxy for the temperature of snow formation above the site, taken to be representative of Antartic temperature over such timescales.</p></li>
<li><p>gas phase <span class="math notranslate nohighlight">\(CO_2\)</span> measurements from <a class="reference external" href="https://www.nature.com/articles/nature06949">Luthi et al (2008)</a>, corrected by <a class="reference external" href="http://onlinelibrary.wiley.com/doi/10.1002/2014GL061957/abstract">Bereiter et al. (2015)</a>.</p></li>
</ul>
</section>
<section id="demonstration">
<h2>Demonstration<a class="headerlink" href="#demonstration" title="Link to this heading">#</a></h2>
<p>Let us first load necessary packages:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">load_ext</span> watermark

<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pyleoclim</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pyleo</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/Users/julieneg/opt/miniconda3/envs/pyleo/lib/python3.11/site-packages/pyproj/__init__.py:89: UserWarning: pyproj unable to set database path.
  _pyproj_global_context_initialize()
</pre></div>
</div>
</div>
</div>
<section id="loading-and-visualizing-delta-d-series">
<h3>Loading and visualizing <span class="math notranslate nohighlight">\(\delta D\)</span> series<a class="headerlink" href="#loading-and-visualizing-delta-d-series" title="Link to this heading">#</a></h3>
<p>This dataset ships with the package, so all we need to do is use <code class="docutils literal notranslate"><span class="pre">load_dataset()</span></code></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dD</span> <span class="o">=</span> <span class="n">pyleo</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">load_dataset</span><span class="p">(</span><span class="s1">&#39;EDC-dD&#39;</span><span class="p">)</span>
<span class="n">dDts</span> <span class="o">=</span> <span class="n">dD</span><span class="o">.</span><span class="n">convert_time_unit</span><span class="p">(</span><span class="s1">&#39;ky BP&#39;</span><span class="p">)</span>
<span class="n">dDts</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(&lt;Figure size 1000x400 with 1 Axes&gt;,
 &lt;Axes: xlabel=&#39;Age [ka]&#39;, ylabel=&#39;$\\delta \\mathrm{D}$ [‰]&#39;&gt;)
</pre></div>
</div>
<img alt="../_images/04683c70dd332b01b6a447e7e1b876f05e03b3d52397ec2ae5bc571eb0075fc8.png" src="../_images/04683c70dd332b01b6a447e7e1b876f05e03b3d52397ec2ae5bc571eb0075fc8.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dDts</span><span class="o">.</span><span class="n">metadata</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;lat&#39;: -75.1011,
 &#39;lon&#39;: 123.3478,
 &#39;elevation&#39;: 3233,
 &#39;time_unit&#39;: &#39;ka&#39;,
 &#39;time_name&#39;: &#39;Age&#39;,
 &#39;value_unit&#39;: &#39;‰&#39;,
 &#39;value_name&#39;: &#39;$\\delta \\mathrm{D}$&#39;,
 &#39;label&#39;: &#39;EPICA Dome C dD&#39;,
 &#39;archiveType&#39;: &#39;GlacierIce&#39;,
 &#39;sensorType&#39;: &#39;ice sheet&#39;,
 &#39;observationType&#39;: &#39;hydrogen isotopes&#39;,
 &#39;importedFrom&#39;: &#39;https://www.ncei.noaa.gov/pub/data/paleo/icecore/antarctica/epica_domec/edc3deuttemp2007.txt&#39;,
 &#39;control_archiveType&#39;: False,
 &#39;log&#39;: None}
</pre></div>
</div>
</div>
</div>
<p>Notice that the series contains quite a bit of metadata (information about the data), and that this information is now being used by the code to properly label axes for you. Structuring and labeling your data is a little more work upfront, but it pays big dividends down the line. Let’s see that now.</p>
<p>First, take a look at the distribution of time increments:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dDts</span><span class="o">.</span><span class="n">resolution</span><span class="p">()</span><span class="o">.</span><span class="n">dashboard</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(&lt;Figure size 1100x800 with 2 Axes&gt;,
 {&#39;res&#39;: &lt;Axes: xlabel=&#39;Age [ka]&#39;, ylabel=&#39;resolution [ka]&#39;&gt;,
  &#39;res_hist&#39;: &lt;Axes: xlabel=&#39;Counts&#39;&gt;})
</pre></div>
</div>
<img alt="../_images/98d1841e6481e1bb9598b9d74f6cec2d6db658a63752b2225aa88921ddd4e88e.png" src="../_images/98d1841e6481e1bb9598b9d74f6cec2d6db658a63752b2225aa88921ddd4e88e.png" />
</div>
</div>
<p>The data are not evenly spaced, which is a challenge because most timeseries analysis methods (particularly Fourier and wavelet analysis) make the implicit assumption that data are evenly spaced, so applying those tools to unevenly-spaced data will result in methods not behaving as they are supposed to. <code class="docutils literal notranslate"><span class="pre">pyleoclim</span></code> is one of very few packages to enable the Weighted-Wavelet Z transform of <a class="reference external" href="https://adsabs.harvard.edu/full/1996AJ....112.1709F">Foster (1996)</a>, which is designed for unevenly-spaced data. Unfortunately, and despite heroic feats of numerical optimization by its writer Feng Zhu, it can be very slow to run on large datasets, particularly when assessing significance with thousands of Monte Carlo simulations. We therefore interpolate the data at 500y resolution to enable the much faster CWT algorithm of <a class="reference external" href="https://doi.org/10.1175/1520-0477(1998)079%3C0061:APGTWA%3E2.0.CO;2">Torrence &amp; Compo (1998)</a> to run. We also standardize because the  original data range is rather large, which could cause numerical issues.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dD05</span> <span class="o">=</span> <span class="n">dDts</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">step</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span><span class="o">.</span><span class="n">standardize</span><span class="p">()</span> 
</pre></div>
</div>
</div>
</div>
</section>
<section id="wavelet-analysis">
<h3>Wavelet Analysis<a class="headerlink" href="#wavelet-analysis" title="Link to this heading">#</a></h3>
<p><a class="reference external" href="https://figshare.com/articles/presentation/PyRATES_presentations_June_2024/25939801?file=46768570">Wavelet analysis</a> may be used to “unfold” a spectrum and look at its evolution over time. There are several ways to access that functionality in <code class="docutils literal notranslate"><span class="pre">Pyleoclim</span></code>, but here we use <code class="docutils literal notranslate"><span class="pre">summary_plot()</span></code>, which stacks together the timeseries itself, its scalogram (a plot of the magnitude of the wavelet power), and the power spectral density (PSD) obtained from summing the wavelet coefficients over time.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">scal</span> <span class="o">=</span> <span class="n">dD05</span><span class="o">.</span><span class="n">wavelet</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">scal</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(&lt;Figure size 1000x800 with 2 Axes&gt;,
 &lt;Axes: title={&#39;center&#39;: &#39;EPICA Dome C $\\delta D$ scalogram (CWT)&#39;}, xlabel=&#39;Age [kyr BP]&#39;, ylabel=&#39;Scale [kyrs]&#39;&gt;)
</pre></div>
</div>
<img alt="../_images/dbaf55d7c20b21e8d4ba6d709c6b6ef1ba721295789498d75dba937f7352f820.png" src="../_images/dbaf55d7c20b21e8d4ba6d709c6b6ef1ba721295789498d75dba937f7352f820.png" />
</div>
</div>
</section>
<section id="customizing-the-frequency-range">
<h3>Customizing the frequency range<a class="headerlink" href="#customizing-the-frequency-range" title="Link to this heading">#</a></h3>
<p>Given the uneven resolution, we might be justifiably skeptical of the ability of this record to track high-resolution fluctuations. Say we wanted to focus on oscillations in the 5-200kyr range. We can focus the analysis on this range, which will help highlight what we want, and also reduce computational expense:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">scal_5_200</span> <span class="o">=</span> <span class="n">dD05</span><span class="o">.</span><span class="n">wavelet</span><span class="p">(</span><span class="n">freq_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;fmin&#39;</span><span class="p">:</span><span class="mi">1</span><span class="o">/</span><span class="mi">200</span><span class="p">,</span><span class="s1">&#39;fmax&#39;</span><span class="p">:</span><span class="mi">1</span><span class="o">/</span><span class="mi">5</span><span class="p">,</span><span class="s1">&#39;nf&#39;</span><span class="p">:</span><span class="mi">50</span><span class="p">})</span>
<span class="n">scal_5_200</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(&lt;Figure size 1000x800 with 2 Axes&gt;,
 &lt;Axes: title={&#39;center&#39;: &#39;EPICA Dome C $\\delta D$ scalogram (CWT)&#39;}, xlabel=&#39;Age [kyr BP]&#39;, ylabel=&#39;Scale [kyrs]&#39;&gt;)
</pre></div>
</div>
<img alt="../_images/5f4d4c24c9adc961f299cf62c6912da66295daba091afcec71b29178ee97d00d.png" src="../_images/5f4d4c24c9adc961f299cf62c6912da66295daba091afcec71b29178ee97d00d.png" />
</div>
</div>
<p>Alternatively, one could  make a custom frequency vector using NumPy and pass it directly to the method:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">freq</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log2</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">200</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">log2</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">5</span><span class="p">),</span><span class="n">num</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">base</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span> 
<span class="n">scal_5_200</span> <span class="o">=</span> <span class="n">dD05</span><span class="o">.</span><span class="n">wavelet</span><span class="p">(</span><span class="n">freq</span><span class="o">=</span><span class="n">freq</span><span class="p">)</span>
<span class="n">scal_5_200</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(&lt;Figure size 1000x800 with 2 Axes&gt;,
 &lt;Axes: title={&#39;center&#39;: &#39;EPICA Dome C $\\delta D$ scalogram (CWT)&#39;}, xlabel=&#39;Age [kyr BP]&#39;, ylabel=&#39;Scale [kyrs]&#39;&gt;)
</pre></div>
</div>
<img alt="../_images/2376d8b8496f1747568db094d850d3003a8ea4567128cb796cff812b6a117d61.png" src="../_images/2376d8b8496f1747568db094d850d3003a8ea4567128cb796cff812b6a117d61.png" />
</div>
</div>
</section>
<section id="significance-testing">
<h3>Significance Testing<a class="headerlink" href="#significance-testing" title="Link to this heading">#</a></h3>
<p>The scalogram reveals how spectral power (technically, wavelet power) changes over time. But which aspects of this are significant? There are two ways to test this in <code class="docutils literal notranslate"><span class="pre">pyleoclim</span></code>, both using an AR(1) benchmark. The first uses a parametric, asymptotic form of the theoretical spectrum of an AR(1) process:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">scal_sig</span> <span class="o">=</span> <span class="n">scal_5_200</span><span class="o">.</span><span class="n">signif_test</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;ar1asym&#39;</span><span class="p">)</span>
<span class="n">scal_sig</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(&lt;Figure size 1000x800 with 2 Axes&gt;,
 &lt;Axes: title={&#39;center&#39;: &#39;EPICA Dome C $\\delta D$ scalogram (CWT) with 95% threshold&#39;}, xlabel=&#39;Age [kyr BP]&#39;, ylabel=&#39;Scale [kyrs]&#39;&gt;)
</pre></div>
</div>
<img alt="../_images/e09187980d7db1b36b979d65b1eb98b91f0c415d69451ba41d294ea9620665d1.png" src="../_images/e09187980d7db1b36b979d65b1eb98b91f0c415d69451ba41d294ea9620665d1.png" />
</div>
</div>
<p>The white lines delineate regions of the scalogram that are significant against an AR(1) benchmark, thus encircling “islands” of notable power. We see that the 100kyr periodicity is particularly pronounced around 300-600 kyr BP, while the 40 and 20kyr periodicities are more pronounced in the later portions (since 400 ky BP). This may be because of the compaction of the ice at depth, which you wouldn’t know from analyzing just this dataset. Paleoclimate timeseries must always be interpreted with those possible artifacts in mind. There are a lot of significant islands at short (&lt;10ky) scales as well, but it is unclear whether this is reflective of large-scale climate variability.</p>
<p>Now, notice that we specified the method <code class="docutils literal notranslate"><span class="pre">ar1asym</span></code> for the asssessment of significance; this tells the code to use an asymptotic approximation to the distribution of the AR(1) benchmarks, making it lightning-fast. We could also have used direct simulation (the default method, because it applies to other wavelet methods like <code class="docutils literal notranslate"><span class="pre">wwz</span></code>), and indeed this would yield a very similar result:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">scal_sig2</span> <span class="o">=</span> <span class="n">scal_5_200</span><span class="o">.</span><span class="n">signif_test</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;ar1sim&#39;</span><span class="p">,</span> <span class="n">number</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">)</span>
<span class="n">scal_sig2</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Performing wavelet analysis on individual series: 100%|██████████| 1000/1000 [00:27&lt;00:00, 36.97it/s]
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(&lt;Figure size 1000x800 with 2 Axes&gt;,
 &lt;Axes: title={&#39;center&#39;: &#39;EPICA Dome C $\\delta D$ scalogram (CWT) with 95% threshold&#39;}, xlabel=&#39;Age [kyr BP]&#39;, ylabel=&#39;Scale [kyrs]&#39;&gt;)
</pre></div>
</div>
<img alt="../_images/1418e6e1e645bbdb6fd6f57af2bf187a07271e3a8491aecdbf76f5f11e1eea8a.png" src="../_images/1418e6e1e645bbdb6fd6f57af2bf187a07271e3a8491aecdbf76f5f11e1eea8a.png" />
</div>
</div>
<p>However, an AR(1) benchmark (whether analytical or simulated) may not be the most appropriate here, as the spectrum appears to show scaling behavior (i.e. its spectrum can be reasonably approximated by a power law <span class="math notranslate nohighlight">\(f^{-\beta}\)</span>, which will show up as a straight line in log-log space):</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">psd</span> <span class="o">=</span> <span class="n">dDts</span><span class="o">.</span><span class="n">spectral</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;wwz&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>OMP: Info #276: omp_set_nested routine deprecated, please use omp_set_max_active_levels instead.
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">psd</span><span class="o">.</span><span class="n">beta_est</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(&lt;Figure size 1000x400 with 1 Axes&gt;,
 &lt;Axes: xlabel=&#39;Period [kyr]&#39;, ylabel=&#39;PSD&#39;&gt;)
</pre></div>
</div>
<img alt="../_images/57a48edb9d05c94615572fc50b97a9e7a97a249620ef53f057752b3afb351e4c.png" src="../_images/57a48edb9d05c94615572fc50b97a9e7a97a249620ef53f057752b3afb351e4c.png" />
</div>
</div>
<p>Indeed, a colored noise benchmark would be more appropriate here. Here is how you would invoke it:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">scal_sig3</span> <span class="o">=</span> <span class="n">scal_5_200</span><span class="o">.</span><span class="n">signif_test</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;CN&#39;</span><span class="p">,</span> <span class="n">number</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">)</span>
<span class="n">scal_sig3</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Performing wavelet analysis on individual series: 100%|██████████| 1000/1000 [00:28&lt;00:00, 34.81it/s]
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(&lt;Figure size 1000x800 with 2 Axes&gt;,
 &lt;Axes: title={&#39;center&#39;: &#39;EPICA Dome C $\\delta D$ scalogram (CWT) with 95% threshold&#39;}, xlabel=&#39;Age [kyr BP]&#39;, ylabel=&#39;Scale [kyrs]&#39;&gt;)
</pre></div>
</div>
<img alt="../_images/3da870f4ea6913c9a59221b4c73775ec3c8bfb84db3bdac90663ee6ee94f03f1.png" src="../_images/3da870f4ea6913c9a59221b4c73775ec3c8bfb84db3bdac90663ee6ee94f03f1.png" />
</div>
</div>
<p>Differences are minor, but this benchmark tends to show scales shorter than 20ky as insignificant, and the 80-120ky band is significant throughout the record, unlike in the AR(1) case. This is a reminder to always choose appropriate <a class="reference internal" href="#./L1_surrogates.md"><span class="xref myst">surrogates</span></a>.</p>
</section>
</section>
<section id="temperature-vs-co-2">
<h2>Temperature vs <span class="math notranslate nohighlight">\(CO_2\)</span><a class="headerlink" href="#temperature-vs-co-2" title="Link to this heading">#</a></h2>
<section id="data-wrangling">
<h3>Data Wrangling<a class="headerlink" href="#data-wrangling" title="Link to this heading">#</a></h3>
<p>Now let us load the <span class="math notranslate nohighlight">\(CO_2\)</span> composite from this and other neighboring sites around Antarctica:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;ftp://ftp.ncdc.noaa.gov/pub/data/paleo/icecore/antarctica/antarctica2015co2composite.txt&#39;</span>
<span class="n">co2df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">url</span><span class="p">,</span><span class="n">skiprows</span><span class="o">=</span><span class="mi">137</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="n">co2df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>age_gas_calBP</th>
      <th>co2_ppm</th>
      <th>co2_1s_ppm</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>-51.03</td>
      <td>368.02</td>
      <td>0.06</td>
    </tr>
    <tr>
      <th>1</th>
      <td>-48.00</td>
      <td>361.78</td>
      <td>0.37</td>
    </tr>
    <tr>
      <th>2</th>
      <td>-46.28</td>
      <td>359.65</td>
      <td>0.10</td>
    </tr>
    <tr>
      <th>3</th>
      <td>-44.41</td>
      <td>357.11</td>
      <td>0.16</td>
    </tr>
    <tr>
      <th>4</th>
      <td>-43.08</td>
      <td>353.95</td>
      <td>0.04</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Note that <code class="docutils literal notranslate"><span class="pre">Pandas</span></code> does not always require the file to be on your local computer to load the data. In this case, we passed a simple URL. Let’s load it as a <code class="docutils literal notranslate"><span class="pre">Series</span></code> object with appropriate metadata:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">co2ts</span> <span class="o">=</span> <span class="n">pyleo</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="n">co2df</span><span class="p">[</span><span class="s1">&#39;age_gas_calBP&#39;</span><span class="p">]</span><span class="o">/</span><span class="mi">1000</span><span class="p">,</span>
                     <span class="n">value</span><span class="o">=</span> <span class="n">co2df</span><span class="p">[</span><span class="s1">&#39;co2_ppm&#39;</span><span class="p">],</span>
                     <span class="n">time_name</span><span class="o">=</span><span class="s1">&#39;Age&#39;</span><span class="p">,</span><span class="n">time_unit</span><span class="o">=</span><span class="s1">&#39;kyr BP&#39;</span><span class="p">,</span>
                     <span class="n">value_name</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$CO_2$&#39;</span><span class="p">,</span><span class="n">value_unit</span><span class="o">=</span><span class="s1">&#39;ppm&#39;</span><span class="p">,</span>
                     <span class="n">label</span><span class="o">=</span><span class="s1">&#39;EPICA Dome C CO2&#39;</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">co2ts</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;C1&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(&lt;Figure size 1000x400 with 1 Axes&gt;,
 &lt;Axes: xlabel=&#39;Age [kyr BP]&#39;, ylabel=&#39;$CO_2$ [ppm]&#39;&gt;)
</pre></div>
</div>
<img alt="../_images/04e7b87037e9cc04b152cc1c88212eed4a52ec26ea6ca431618787844e8645f8.png" src="../_images/04e7b87037e9cc04b152cc1c88212eed4a52ec26ea6ca431618787844e8645f8.png" />
</div>
</div>
<p>We see very similar Ice Ages as in the deuterium data, as well as a precipitous rise since the Industrial Revolution. To plot the two series side by side, we can put them into a <a class="reference external" href="https://pyleoclim-util.readthedocs.io/en/latest/core/api.html#multipleseries-pyleoclim-multipleseries">MultipleSeries object</a> and use that class’s default <code class="docutils literal notranslate"><span class="pre">plot()</span></code> function:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ms</span> <span class="o">=</span> <span class="n">pyleo</span><span class="o">.</span><span class="n">MultipleSeries</span><span class="p">([</span><span class="n">dDts</span><span class="p">,</span><span class="n">co2ts</span><span class="p">])</span>
<span class="n">ms</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(&lt;Figure size 1000x400 with 1 Axes&gt;, &lt;Axes: xlabel=&#39;Age [ka]&#39;, ylabel=&#39;value&#39;&gt;)
</pre></div>
</div>
<img alt="../_images/c8819bd9fb42bd198215f9dc46070a729ae5b92c63fdcc76621ab8e20e7288e1.png" src="../_images/c8819bd9fb42bd198215f9dc46070a729ae5b92c63fdcc76621ab8e20e7288e1.png" />
</div>
</div>
<p>By default, the MultipleSeries class assumes commensurate units, which is not the case here. Fear not, we can simply standardize the series:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ms</span><span class="o">.</span><span class="n">standardize</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(&lt;Figure size 1000x400 with 1 Axes&gt;, &lt;Axes: xlabel=&#39;Age [ka]&#39;, ylabel=&#39;value&#39;&gt;)
</pre></div>
</div>
<img alt="../_images/5907c6e8dc18acda26f7537dd16b35d277d2ffafa6704c9d95ff2683ca9a99da.png" src="../_images/5907c6e8dc18acda26f7537dd16b35d277d2ffafa6704c9d95ff2683ca9a99da.png" />
</div>
</div>
</section>
<section id="wavelet-coherence">
<h3>Wavelet Coherence<a class="headerlink" href="#wavelet-coherence" title="Link to this heading">#</a></h3>
<p>We seek to understand potential lead/lag relationships between those two series. Before that, a brief primer: the temperature proxy <span class="math notranslate nohighlight">\(\delta D\)</span> is measured on the ice, whereas <span class="math notranslate nohighlight">\(CO_2\)</span> is measured in the air trapped in the ice. Because bubbles close only progressively as the firn gets compacted, the air can be younger than the surrouding ice by several hundred years. The ice core community has worked diligently on this for decades and have made very clever adjustments to correct for this effect, but that is to be kept in mind when comparing those two data streams.</p>
<p>With that in mind, let us apply <a class="reference external" href="https://hal.archives-ouvertes.fr/hal-00302394/">wavelet transform coherency</a> to identify phase relationships between the two series at various scales:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">coh</span> <span class="o">=</span> <span class="n">co2ts</span><span class="o">.</span><span class="n">wavelet_coherence</span><span class="p">(</span><span class="n">dDts</span><span class="p">,</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;wwz&#39;</span><span class="p">)</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">coh</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/61d9d05c38a56c9715b3dd2775d95ada4e2c32fd8683b360eb7b7c18e9184500.png" src="../_images/61d9d05c38a56c9715b3dd2775d95ada4e2c32fd8683b360eb7b7c18e9184500.png" />
</div>
</div>
<p>This plot shows two things:</p>
<ul class="simple">
<li><p>the wavelet transform coherency (WTC), which may be thought of as a (squared) correlation coefficient in time-scale space: 0 if the series do not covary, 1 if they vary in perfect unison at that time and scale.</p></li>
<li><p>the phase angle between the two series, using a trigonometric convention (right = 0, top = 90 degrees, left = 180 degrees, bottom = -90 or + 270 degrees).</p></li>
</ul>
<p>Arrows pointing to the right indicate a phase angle close to zero at all scales longer than precession. We can quantify that by computing the average phase angle in a given range of scales, like so:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">coh</span><span class="o">.</span><span class="n">phase_stats</span><span class="p">(</span><span class="n">scales</span><span class="o">=</span><span class="p">[</span><span class="mi">80</span><span class="p">,</span><span class="mi">100</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Results(mean_angle=0.11337289763260268, kappa=22.001092896027867, sigma=0.21570904255129714, kappa_hi=391.62700755341325, sigma_lo=0.050563999674677694)
</pre></div>
</div>
</div>
</div>
<p>This means that on orbital timescales, the two series are essentially in phase ; there is no <em>consistent</em> lead or lag between the two series. This is remarkable given the dating challenges mentioned earlier, and is widely interpreted to mean that on such timescales, atmospheric <span class="math notranslate nohighlight">\(CO_2\)</span> is a part of a positive feedback loop amplifying orbitally-triggered changes in temperature. However, the variance of this angle is fairly high, and by this test it does not register as a very consistent signal.
Lastly, note that in the anthropogenic era, atmospheric <span class="math notranslate nohighlight">\(CO_2\)</span> is of course a forcing (the largest climate forcing, currently), acting on much, much faster timescales for which the climate system is still catching up. You would not know it from this analysis, but it’s important to state out loud, given that climate deniers have an annoying tendency to cherry-pick the paleoclimate record in support of their feeble arguments.</p>
<p>One might be tempted to interpret phase angles at shorter scales. Let us first see if they are significant against AR(1) benchmarks. As before this can be done in one function call, though some patience is required to obtain the result.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">coh_sig</span> <span class="o">=</span> <span class="n">coh</span><span class="o">.</span><span class="n">signif_test</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;CN&#39;</span><span class="p">,</span><span class="n">number</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Performing wavelet coherence on surrogate pairs: 100%|██████████| 100/100 [1:00:00&lt;00:00, 36.01s/it]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">coh_sig</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/2024fcc4b6d09aa72325231d2d3aab72744d2e9d12aa2c858bb625bf897f7e4c.png" src="../_images/2024fcc4b6d09aa72325231d2d3aab72744d2e9d12aa2c858bb625bf897f7e4c.png" />
</div>
</div>
<p>These phase differences are indeed significant according to this test, but mostly inconsistent (at a given scale, the arrows veer one way or the other). This would not be a good candidate for identifying a robust lead or lag. One would find the same result with <code class="docutils literal notranslate"><span class="pre">phase_stats()</span></code>.</p>
<p>Another consideration is that coherency is like the correlation coefficient in wavelet space: it tells you how similar two series are for a given time and scale, yet it says nothing about what fraction of the total variability is shared. This is better measured by the cross-wavelet transform (XWT), which highlights areas of high common power. Both of those, along with the original series, can be visualized with one swift function call:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">coh_sig</span><span class="o">.</span><span class="n">dashboard</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(&lt;Figure size 900x1200 with 6 Axes&gt;,
 {&#39;ts1&#39;: &lt;Axes: ylabel=&#39;$CO_2$ [ppm]&#39;&gt;,
  &#39;ts2&#39;: &lt;Axes: xlabel=&#39;Age [ka]&#39;, ylabel=&#39;$\\delta \\mathrm{D}$ [‰]&#39;&gt;,
  &#39;wtc&#39;: &lt;Axes: ylabel=&#39;Scale [kyrs]&#39;&gt;,
  &#39;xwt&#39;: &lt;Axes: xlabel=&#39;Age [kyr BP]&#39;, ylabel=&#39;Scale [kyrs]&#39;&gt;})
</pre></div>
</div>
<img alt="../_images/df8eaa5363c3723a5f35a812742a2fcd1ff360fe7e318df2c4b51206ce6c0fdf.png" src="../_images/df8eaa5363c3723a5f35a812742a2fcd1ff360fe7e318df2c4b51206ce6c0fdf.png" />
</div>
</div>
<p>Here we see that the orbital bands are the only ones to show up consistently throughout the record, but precession and obliquity fade before 200 ky BP in their common power, and the XWT band near 120 ka drifts to 80ka back in time. This means that, out of the large swathes of WTC one would consider “coherent”, only those areas highlighted in XWT in green-yellow are likely important.  That’s where we stop the banter, though: when you are getting down to that level, you had better be a glaciologist, or talk to one about what is going on in those datasets.</p>
</section>
<section id="takeways">
<h3>Takeways<a class="headerlink" href="#takeways" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">Pyleoclim</span></code> enables wavelet and wavelet coherence analysis.</p></li>
<li><p>evenly-spaced data are handled with the CWT algorithm of <a class="reference external" href="https://doi.org/10.1175/1520-0477(1998)079%3C0061:APGTWA%3E2.0.CO;2">Torrence &amp; Compo (1998)</a>, which is very fast; unevenly-spaced data are handled through the WWZ algorithm of <a class="reference external" href="https://adsabs.harvard.edu/full/1996AJ....112.1709F">Foster (1996)</a>, which is slow. The temptation to interpolate is strong, but it has downsides. WWZ should be preferred, though CWT+interpolation can be used at exploratory stages.</p></li>
<li><p>Both <a class="reference external" href="https://pyleoclim-util.readthedocs.io/en/master/core/api.html#scalogram-pyleoclim-scalogram">Scalogram</a> and <a class="reference external" href="https://pyleoclim-util.readthedocs.io/en/master/core/api.html#coherence-pyleoclim-coherence">Coherence</a> objects have a built-in <code class="docutils literal notranslate"><span class="pre">signif_test()</span></code> method, which the <code class="docutils literal notranslate"><span class="pre">plot()</span></code> method will know what to do with.</p></li>
<li><p>Wavelet Transform Coherency may be thought of as a (squared) correlation coefficient in time-scale space: 0 if the series do not covary, 1 if they vary in perfect unison at that time and scale.</p></li>
<li><p>Properly interpreting the results of wavelet and wavelet coherence analyses requires knowing something about the methods.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">watermark</span> -n -u -v -iv -w
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Last updated: Mon Jun 17 2024

Python implementation: CPython
Python version       : 3.11.9
IPython version      : 8.25.0

numpy     : 1.26.4
matplotlib: 3.9.0
pyleoclim : 1.0.0
pandas    : 2.1.4

Watermark: 2.4.3
</pre></div>
</div>
</div>
</div>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./notebooks"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="L2_tracing_transformations.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Tracing Transformations</p>
      </div>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#preamble">Preamble</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#goals">Goals</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#keywords">Keywords</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#pre-requisites">Pre-requisites</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#relevant-packages">Relevant Packages</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#data-description">Data description</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#demonstration">Demonstration</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#loading-and-visualizing-delta-d-series">Loading and visualizing <span class="math notranslate nohighlight">\(\delta D\)</span> series</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#wavelet-analysis">Wavelet Analysis</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#customizing-the-frequency-range">Customizing the frequency range</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#significance-testing">Significance Testing</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#temperature-vs-co-2">Temperature vs <span class="math notranslate nohighlight">\(CO_2\)</span></a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#data-wrangling">Data Wrangling</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#wavelet-coherence">Wavelet Coherence</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#takeways">Takeways</a></li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Deborah Khider, Julien Emile-Geay, Jordan Landers, Alexander James, Feng Zhu
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>